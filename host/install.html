<!DOCTYPE html><!--[if lte IE 7]> <html class="no-js ie67 ie678" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js ie8 ie678" lang="en"> <![endif]-->
<!--[if IE 9]> <html class="no-js ie9" lang="en"> <![endif]-->
<html lang="en">
  <head>
    <meta charset="utf-8"><!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/assets/images/favicon.png">
    <title>Install
    </title><link  rel="stylesheet" href="/vendors/css/knacss.css" /><link  rel="stylesheet" href="/vendors/css/sunburst.css" /><link  rel="stylesheet" href="/assets/css/main.css" /><link  rel="stylesheet" href="/assets/css/home.css" />
  </head>
  <body>
    <div class="navbar fixed"><a href="/" class="nav-logo left"><img src="/assets/images/happycloud.png" alt="Happy Cloud"></a><span class="subtitle">
        <div class="breadcrumb-item current"><a href="/host/install.html">Install</a>
        </div>
        <div class="breadcrumb-item"><a href="/host/manage.html">Manage</a>
        </div>
        <div class="breadcrumb-item"><a href="/host/uninstall.html">Uninstall</a>
        </div>
        <div class="breadcrumb-item"><a href="/host/trouble-shootings.html">Trouble Shootings</a>
        </div></span>
      <div class="submenu-container right"><a href="/hack/getting-started/">Hack</a></div>
      <div class="submenu-container right selected"><a href="/host/install.html">Host</a></div>
    </div>
    <div class="wrapper">
      <div class="wrap-menu w25 mod left">&nbsp;
        <aside>
          <p class="title toc">Install</p>
          <nav id="navigation" role="navigation">
            <ul class="nav first-level">
              <li class="big"><a href="#generic-information" class="label">Generic information</a>
                <ul class="second-level">
                  <li class="small"><a href="#hardware-requirements" class="label">Hardware requirements</a></li>
                  <li class="small"><a href="#about-security-in-pre-installed-images" class="label">About security in pre-installed images</a></li>
                </ul>
              </li>
              <li class="big"><a href="#manual-installation" class="label">Manual installation</a>
                <ul class="second-level">
                  <li class="small"><a href="#use-our-script" class="label">Use our script</a></li>
                  <li class="small"><a href="#test" class="label">Test</a></li>
                  <li class="small"><a href="#what-will-this-script-install-on-your-server-" class="label">What will this script install on your server?</a></li>
                  <li class="small"><a href="#about-virtual-machines-and-containers" class="label">About virtual machines and containers</a></li>
                </ul>
              </li>
              <li class="big"><a href="#raspberry-pi-image" class="label">Raspberry Pi image</a>
                <ul class="second-level">
                </ul>
              </li>
              <li class="big"><a href="#virtualbox-image" class="label">Virtualbox image</a>
                <ul class="second-level">
                  <li class="small"><a href="#download-requirements" class="label">Download requirements</a></li>
                  <li class="small"><a href="#import-and-try" class="label">Import and try</a></li>
                  <li class="small"><a href="#additional-informations" class="label">Additional informations</a></li>
                </ul>
              </li>
              <li class="big"><a href="#openvz-image" class="label">OpenVZ image</a>
                <ul class="second-level">
                  <li class="small"><a href="#download-and-start" class="label">Download and start</a></li>
                  <li class="small"><a href="#with-a-configured-network" class="label">With a configured network</a></li>
                </ul>
              </li>
              <li class="big"><a href="#lxc-image" class="label">LXC image</a>
                <ul class="second-level">
                </ul>
              </li>
              <li class="big"><a href="#hosting-services" class="label">Hosting services</a>
                <ul class="second-level">
                  <li class="small"><a href="#cozycloud" class="label">Cozycloud</a></li>
                </ul>
              </li>
            </ul>
          </nav>
        </aside>
      </div>
      <div id="main" role="main" class="mod pam w75"><h1 id="installing-cozy">Installing Cozy</h1>
<h2 id="generic-information">Generic information</h2>
<h3 id="hardware-requirements">Hardware requirements</h3>
<p>The CPU is not a limitation, Cozy can even run on RaspberryPi.</p>
<h4 id="mininum">Mininum</h4>
<ul>
<li>RAM: 512MB (it allows to have 4 apps running simultaneously)</li>
<li>Disk space: 2GB</li>
</ul>
<h4 id="recommended">Recommended</h4>
<ul>
<li>RAM: 1024 Mo (it allows to have 10 apps simultaneously).</li>
<li>Disk space: a lot of space to store all your files.</li>
</ul>
<h3 id="about-security-in-pre-installed-images">About security in pre-installed images</h3>
<p>For a production usage, you MUST renew the SSL certificate, reset the database credentials and reset the controller token.</p>
<p>For this purpose, use the following command:</p>
<pre class="highlight"><code class="bash">wget https://raw.github.com/mycozycloud/cozy-setup/master/fabfile.py
fab -H user@ip reset_security_tokens
</code></pre>
<p>You should also change the superuser credentials and by the way, you should not user a password but a SSH key to connect to your Cozy. Please see <a href="http://www.debian-administration.org/article/SSH_with_authentication_key_instead_of_password">this tutorial</a> to help you.</p>
<h2 id="manual-installation">Manual installation</h2>
<h3 id="use-our-script">Use our script</h3>
<p>On your local machine install Fabric and fabtools:</p>
<pre class="highlight"><code class="bash">apt-get install python python-pip python-dev software-properties-common
<span class="hljs-built_in">sudo</span> pip install fabric fabtools
</code></pre>
<p>Download our Fabric file (a script that will run commands on your remote
server):</p>
<pre class="highlight"><code class="bash">wget https://raw.github.com/mycozycloud/cozy-setup/master/fabfile.py
</code></pre>
<p>Once your system is prepared, use the Fabric script from your local
machine to launch the Cozy installation (run it in the same directory as the fabfile
you have previously downloaded):</p>
<pre class="highlight"><code class="bash">fab -H sudoer@ip install
</code></pre>
<p>Where "sudoer" is a sudo user and "ip" your server IP.</p>
<p>Enter your settings (such as domain name) when prompted by the installer.</p>
<p>Be patient; some commands or app deployments can take some time. It
depends on your network and hardware capabilities.</p>
<h4 id="about-local-installation">About local installation</h4>
<p>To install Cozy locally, we recommend you to create a virtual machine,
and then to run the fabfile script with your virtual machine as target.
This allows you to experiment with Cozy without installing numerous packages
into your environment.</p>
<p>The way to install it locally without VM or container is to run this command:</p>
<pre class="highlight"><code class="bash">fab -H sudoer@localhost install
</code></pre>
<h4 id="try-cozy-with-vagrant">Try Cozy with Vagrant</h4>
<p>If you want to use Vagrant to run Cozy Cloud Setup in a virtual machine
we recommend you to use the Ubuntu 12.04 box. Be careful as the update will require that
you configure your boot sequence. Choose the first filesystem that is offered, then click ok.</p>
<p><a href="http://files.vagrantup.com/precise64.box">http://files.vagrantup.com/precise64.box</a></p>
<h3 id="test">Test</h3>
<p>Once the installation is done, you can access <a href="https://IP:443">https://IP:443</a> to create your Cozy
main account. Be sure that you used the HTTPS protocol, if you just see the nginx
welcome page.</p>
<h3 id="what-will-this-script-install-on-your-server-">What will this script install on your server?</h3>
<p>The Cozy install script installs the following tools:</p>
<ul>
<li>Python runtime</li>
<li>Node.js runtime</li>
<li>CouchDB document database</li>
<li>Node tools: cozy-controller, cozy-monitor, coffee-script, compound, brunch</li>
<li>Cozy Controller Daemon</li>
<li>Cozy data indexer</li>
<li>Cozy data layer</li>
<li>Cozy proxy</li>
<li>Cozy Home (web app)</li>
</ul>
<p>If you want to know more about how Cozy works, you can check our <a href="https://github.com/mycozycloud/cozy-setup/wiki/Cozy-architecture">architecture
page</a>.</p>
<h3 id="about-virtual-machines-and-containers">About virtual machines and containers</h3>
<p>Because of the numerous technologies involved, we recommend you to run the Cozy
stack in an isolated virtual machine or in a container (OpenVz or LXC).</p>
<h2 id="raspberry-pi-image">Raspberry Pi image</h2>
<p><em>Warning: For a production usage you have to change the superuser credentials,
renew the SSL certificate, the database credentials and the controller token.</em></p>
<p>In order to run Cozy on your Raspberry Pi, the simplest way is to download our image and
set it up on a SD card.</p>
<p>For that, get the image archive:</p>
<pre class="highlight"><code class="bash"><span class="hljs-comment"># Download the image (~ 1.5GB)</span>
wget http://files.cozycloud.cc/cozy-raspberrypi.im.tar.gz

<span class="hljs-comment"># Uncompress it</span>
tar -xvzf cozy-raspberrypi.im.tar.gz
</code></pre>
<p>Next, find where is mounted your SDCard; let's assume it is on <em>/dev/sdc</em>,
then make a low level copy of the image to your card.</p>
<p>WARNING: this operation will erase all previously stored data into the card.</p>
<pre class="highlight"><code class="bash"><span class="hljs-built_in">sudo</span> dd bs=<span class="hljs-number">4</span>M <span class="hljs-keyword">if</span>=/my/path/cozy-raspberry.im of=/dev/sdc
</code></pre>
<p>Now insert the SD Card in your Raspberry Pi SD Card reader. Reboot your
Raspberry, then you will be able to access to your Cozy through the port 443
(https protocol).</p>
<h2 id="virtualbox-image">Virtualbox image</h2>
<p><em>Warning: For a production usage you have to change the superuser credentials,
renew the SSL certificate, the database credentials and the controller token.</em></p>
<h3 id="download-requirements">Download requirements</h3>
<ul>
<li><a href="https://www.virtualbox.org/wiki/Downloads">Download</a> and install VirtualBox.</li>
<li><a href="http://files.cozycloud.cc/cozycloud-virtualimage.zip">Download</a> the Cozy
Virtual Machine for VirtualBox</li>
</ul>
<h3 id="import-and-try">Import and try</h3>
<p>Import the image to Virtualbox and start it.
You should be able to access to your Cozy through your browser by connecting to this URL:</p>
<pre class="highlight"><code class="bash">https://localhost:<span class="hljs-number">2223</span>/
</code></pre>
<h3 id="additional-informations">Additional informations</h3>
<p>To access to the box shell use root/password as login and password.</p>
<p>You can find the box ip with the <code>ifconfig</code> command.</p>
<p>You can connect through ssh with:</p>
<pre class="highlight"><code class="bash">ssh -p <span class="hljs-number">2222</span> root@localhost
</code></pre>
<h2 id="openvz-image">OpenVZ image</h2>
<p>Here we assume that you have already installed OpenVZ utilities.</p>
<h3 id="download-and-start">Download and start</h3>
<pre class="highlight"><code class="bash"><span class="hljs-comment"># Download the OpenVz template (~ 1.3GB)</span>
wget http://files.cozycloud.cc/vzdump-openvz-cozycloud-debian.tar

<span class="hljs-comment"># Mount and start the container</span>
vzrestore vzdump-openvz-cozycloud-debian.tar ctid
vzctl start ctid
</code></pre>
<p><em>Credentials are root/password</em></p>
<p>NB: Replace ctid by an available ctid (101, 102, etc.)</p>
<h3 id="with-a-configured-network">With a configured network</h3>
<p>You will probably need to give access to your container from outside of your
host. Here is a way to do it:</p>
<pre class="highlight"><code class="bash"><span class="hljs-comment"># Download the OpenVz template (~ 1.3GB)</span>
wget http://files.cozycloud.cc/vzdump-openvz-cozycloud-debian.tar

<span class="hljs-comment"># Mount your new container, give it an IP address and start it:</span>
vzrestore vzdump-openvz-cozycloud-debian.tar ctid
vzctl <span class="hljs-keyword">set</span> ctid --ipadd <span class="hljs-number">10.0</span>.<span class="hljs-number">0.10</span>  --save
vzctl start ctid

<span class="hljs-comment"># Setup a reverse proxy that routes your 8888 port to https://10.0.0.10:443</span>
<span class="hljs-comment"># (Use Nginx for instance).</span>
<span class="hljs-comment"># ...</span>
<span class="hljs-comment"># Then authorize the routing:</span>
/sbin/iptables -t nat -A PREROUTING -i vmbr0 -p tcp --dport <span class="hljs-number">8888</span> -j DNAT --to <span class="hljs-number">10.0</span>.<span class="hljs-number">0.10</span>:<span class="hljs-number">443</span>
</code></pre>
<p>Of course you can change 8888 by the value you want.</p>
<h2 id="lxc-image">LXC image</h2>
<p>Use the LXC webpanel to add and configure containers; it's very easy to use.
For Ubuntu this can be installed this way:</p>
<pre class="highlight"><code class="bash"><span class="hljs-built_in">sudo</span> apt-get install -y lxc debootstrap bridge-utils
<span class="hljs-built_in">sudo</span> su
wget http://lxc-webpanel.github.com/tools/install.sh -O - | bash
<span class="hljs-keyword">exit</span>
</code></pre>
<p>Now access the webpanel at <a href="http://myhost.com:5000">http://myhost.com:5000</a>, the default login is admin/admin
(change this). Create a container, remember what you named it. Make it run at
startup. Then, go to command line to access the container.</p>
<pre class="highlight"><code class="bash">lxc console &lt;container name&gt;
</code></pre>
<p>Follow the Cozy installation instructions (install fab, curl fabfile). Once
finished, Cozy is up and running and your Cozy container will be listening on
port 9104. You also need to know the IP address that LXC assigned to your
container:</p>
<pre class="highlight"><code class="bash">/sbin/ifconfig <span class="hljs-variable">$1</span> | grep <span class="hljs-string">"inet addr"</span> | awk -F: <span class="hljs-string">'{print $2}'</span> | awk <span class="hljs-string">'{print $1}'</span>
</code></pre>
<p>Exit your container. Now that it's set up, you should disable the LXC webpanel
since, it's a security risk.</p>
<pre class="highlight"><code class="bash"><span class="hljs-built_in">sudo</span> service lwp stop
<span class="hljs-built_in">sudo</span> update-rc.d <span class="hljs-operator">-f</span> lwp remove
</code></pre>
<p>Finally, set up your main server as a reverse proxy for the cozy container. For
nginx we used this template:</p>
<pre class="highlight"><code class="bash">server {
    listen <span class="hljs-number">80</span>;

    server_name cloud.myhost.com;

    access_log  /var/log/nginx/cozy_access.log;
    error_log  /var/log/nginx/cozy_error.log;
    root   /usr/share/nginx/html;
    index  index.html index.htm;

        location / {
                proxy_<span class="hljs-keyword">set</span>_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;
                proxy_<span class="hljs-keyword">set</span>_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;
                proxy_<span class="hljs-keyword">set</span>_header Host <span class="hljs-variable">$http_host</span>;
                proxy_<span class="hljs-keyword">set</span>_header X-NginX-Proxy <span class="hljs-literal">true</span>;
                proxy_pass http://&lt;container IP&gt;:<span class="hljs-number">9104</span>;
                proxy_redirect http://&lt;container IP&gt;:<span class="hljs-number">9104</span> https://<span class="hljs-variable">$server_name</span>/;
        }
}
</code></pre>
<p>Restart nginx, and your Cozy should be accessible at <a href="http://cloud.myhost.com">http://cloud.myhost.com</a></p>
<h2 id="hosting-services">Hosting services</h2>
<h3 id="cozycloud">Cozycloud</h3>
<p><a href="https://cozycloud.cc">Cozycloud</a> is the maintainer of the Cozy project.</p>

      </div>
      <footer id="footer" role="contentinfo" class="line pam row"><a href="https://github.com/mycozycloud">Github</a><a href="irc://irc.freenode.net/cozycloud">IRC</a><a href="mailto:contact@cozycloud.cc">Contact</a><a href="https://groups.google.com/forum/?fromgroups#!forum/cozy-cloud">Mailing-list</a><a href="https://cozycloud.cc">Cozy Cloud</a></footer>
    </div><script defer="defer"  src="/vendors/javascripts/jquery-2.0.3.min.js"></script><script defer="defer"  src="/vendors/javascripts/bootstrap.min.js"></script><script defer="defer"  src="/assets/javascripts/main.js"></script>
  </body>
</html>